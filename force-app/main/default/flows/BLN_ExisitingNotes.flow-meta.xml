<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <assignments>
        <name>Content_Note_Assignment</name>
        <label>Content Note Assignment</label>
        <locationX>138</locationX>
        <locationY>1946</locationY>
        <assignmentItems>
            <assignToReference>CaseNote</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>Case Note-</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CaseNote</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Num</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CaseNote</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>: </stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CaseNote</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>CaseCommentsLoop.CommentBody</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CaseNote</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue> &lt;br/&gt;&lt;br/&gt;</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CaseNote</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>Note Captured: </stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CaseNote</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>CaseCommentsLoop.CreatedDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CaseNote</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>&lt;br/&gt;&lt;br/&gt;</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Num</assignToReference>
            <operator>Add</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>notes_loop</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Clock_In_Check</name>
        <label>Clock In Check?</label>
        <locationX>182</locationX>
        <locationY>350</locationY>
        <defaultConnector>
            <targetReference>InstructionsForCICO</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>IsCheckedIn</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>get_service_resource</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Id_And_UserId_Null_Check</name>
        <label>Id And UserId Null Check</label>
        <locationX>380</locationX>
        <locationY>134</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Check_if_Id_And_UserId_is_not_null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>UserId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Check_Clock_In</targetReference>
            </connector>
            <label>Check if Id And UserId is not null</label>
        </rules>
    </decisions>
    <decisions>
        <name>R1_check</name>
        <label>R1 check</label>
        <locationX>182</locationX>
        <locationY>1082</locationY>
        <defaultConnector>
            <targetReference>Display_Screen</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>R1_is_false</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>STRec.BLN_ConsiderforR1__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>work_step_Pre_Inspection</targetReference>
            </connector>
            <label>R1 is false</label>
        </rules>
    </decisions>
    <description>FOUK-2428. to show Existing Notes to technician</description>
    <environments>Default</environments>
    <interviewLabel>Exisiting Notes {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Exisiting Notes</label>
    <loops>
        <name>notes_loop</name>
        <label>notes loop</label>
        <locationX>50</locationX>
        <locationY>1838</locationY>
        <assignNextValueToReference>CaseCommentsLoop</assignNextValueToReference>
        <collectionReference>CaseCommentsRec</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Content_Note_Assignment</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Exisiting_Notes</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>FieldServiceMobile</processType>
    <recordLookups>
        <name>Case_Comments</name>
        <label>Case Comments</label>
        <locationX>50</locationX>
        <locationY>1730</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>notes_loop</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>CaseRecord.Id</elementReference>
            </value>
        </filters>
        <object>CaseComment</object>
        <outputReference>CaseCommentsRec</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>CommentBody</queriedFields>
        <queriedFields>CreatedDate</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>get_Additional_Inspection</name>
        <label>get Additional Inspection</label>
        <locationX>50</locationX>
        <locationY>1406</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>get_WO</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>WorkOrderLineItemId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WOLIRecord.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Start Additional Inspection</stringValue>
            </value>
        </filters>
        <object>WorkStep</object>
        <outputReference>AdditionalInspection</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>EndTime</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>get_case</name>
        <label>get case</label>
        <locationX>50</locationX>
        <locationY>1622</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Case_Comments</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WorkOrderRec.CaseId</elementReference>
            </value>
        </filters>
        <object>Case</object>
        <outputReference>CaseRecord</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>BLN_AccessibilityRequirement__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>get_Post_Inspection</name>
        <label>get Post Inspection</label>
        <locationX>50</locationX>
        <locationY>1298</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>get_Additional_Inspection</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>WorkOrderLineItemId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WOLIRecord.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>BLN_WorkStepUniqueName__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>PostInspectionCapturePhotoVideo</stringValue>
            </value>
        </filters>
        <object>WorkStep</object>
        <outputReference>PostInspection</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>EndTime</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>get_service_resource</name>
        <label>get service resource</label>
        <locationX>182</locationX>
        <locationY>758</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>get_WOLI</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>RelatedRecordId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>UserId</elementReference>
            </value>
        </filters>
        <object>ServiceResource</object>
        <outputReference>ServiceResourceRecord</outputReference>
        <queriedFields>Id</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>get_service_territory</name>
        <label>get service territory</label>
        <locationX>182</locationX>
        <locationY>974</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>R1_check</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WOLIRecord.ServiceTerritoryId</elementReference>
            </value>
        </filters>
        <object>ServiceTerritory</object>
        <outputReference>STRec</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>BLN_ConsiderforR1__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>get_WO</name>
        <label>get WO</label>
        <locationX>50</locationX>
        <locationY>1514</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>get_case</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WOLIRecord.WorkOrderId</elementReference>
            </value>
        </filters>
        <object>WorkOrder</object>
        <outputReference>WorkOrderRec</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>CaseId</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>get_WOLI</name>
        <label>get WOLI</label>
        <locationX>182</locationX>
        <locationY>866</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>get_service_territory</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </filters>
        <object>WorkOrderLineItem</object>
        <outputReference>WOLIRecord</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>BLN_AdditionalInspectionNotes__c</queriedFields>
        <queriedFields>BLN_PreInspectionNotes__c</queriedFields>
        <queriedFields>BLN_PostInspectionNotes__c</queriedFields>
        <queriedFields>WorkOrderId</queriedFields>
        <queriedFields>ServiceTerritoryId</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>work_step_Pre_Inspection</name>
        <label>work step Pre Inspection</label>
        <locationX>50</locationX>
        <locationY>1190</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>get_Post_Inspection</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>WorkOrderLineItemId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WOLIRecord.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>BLN_WorkStepUniqueName__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>PreInspectionCapturePhotoVideo</stringValue>
            </value>
        </filters>
        <object>WorkStep</object>
        <outputReference>PreInspection</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>EndTime</queriedFields>
    </recordLookups>
    <screens>
        <name>Display_Screen</name>
        <label>Display Screen</label>
        <locationX>314</locationX>
        <locationY>1190</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>DisplayMsg</name>
            <fieldText>&lt;p&gt;This feature is available for R2.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Exisiting_Notes</name>
        <label>Existing Notes</label>
        <locationX>50</locationX>
        <locationY>2138</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>AccesibilityNotes</name>
            <fieldText>&lt;p&gt;Accessibility Notes:  {!CaseRecord.BLN_AccessibilityRequirement__c}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>JobNotes</name>
            <fieldText>&lt;p&gt;Job-Notes:&lt;/p&gt;&lt;p&gt;Pre-Inspection Notes: {!WOLIRecord.BLN_PreInspectionNotes__c}&lt;/p&gt;&lt;p&gt;Note Captured: {!PreInspection.EndTime}&lt;/p&gt;&lt;p&gt;Additional Notes: {!WOLIRecord.BLN_AdditionalInspectionNotes__c}&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(68, 68, 68); background-color: rgb(255, 255, 255);&quot;&gt;Note Captured: &lt;/span&gt;{!AdditionalInspection.EndTime}&lt;/p&gt;&lt;p&gt;Post Inspection Notes: {!WOLIRecord.BLN_PostInspectionNotes__c}&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(68, 68, 68); background-color: rgb(255, 255, 255);&quot;&gt;Note Captured: &lt;/span&gt; {!PostInspection.EndTime}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Exisitingnotes</name>
            <fieldText>&lt;p&gt;Case Notes:&lt;/p&gt;&lt;p&gt;{!CaseNote}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <nextOrFinishButtonLabel>Next</nextOrFinishButtonLabel>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>InstructionsForCICO</name>
        <label>InstructionsForCICO</label>
        <locationX>270</locationX>
        <locationY>458</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Calling_CICO_Flow</targetReference>
        </connector>
        <fields>
            <name>OpenCICO</name>
            <fieldText>&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;Before performing any operation you must need to &quot;Clock-In&quot; first. Please click Next to &quot;Clock-In&quot;.&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <start>
        <locationX>254</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Id_And_UserId_Null_Check</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <subflows>
        <name>Calling_CICO_Flow</name>
        <label>Calling CICO Flow</label>
        <locationX>270</locationX>
        <locationY>566</locationY>
        <connector>
            <targetReference>get_service_resource</targetReference>
        </connector>
        <flowName>BLN_ShiftCICOManagement</flowName>
        <inputAssignments>
            <name>UserId</name>
            <value>
                <elementReference>UserId</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <name>Check_Clock_In</name>
        <label>Check Clock In</label>
        <locationX>182</locationX>
        <locationY>242</locationY>
        <connector>
            <targetReference>Clock_In_Check</targetReference>
        </connector>
        <flowName>BLN_ClockInCheck</flowName>
        <inputAssignments>
            <name>Id</name>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>UserId</name>
            <value>
                <elementReference>UserId</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>IsCheckedIn</assignToReference>
            <name>OutputOfTheFlow</name>
        </outputAssignments>
    </subflows>
    <variables>
        <name>AdditionalInspection</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>WorkStep</objectType>
    </variables>
    <variables>
        <name>CaseCommentsLoop</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseComment</objectType>
    </variables>
    <variables>
        <name>CaseCommentsRec</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseComment</objectType>
    </variables>
    <variables>
        <name>CaseNote</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>CaseRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <name>Id</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>IsCheckedIn</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <name>NoteLoop</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Note</objectType>
    </variables>
    <variables>
        <name>NoteRecords</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Note</objectType>
    </variables>
    <variables>
        <name>Num</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>1.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>PostInspection</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>WorkStep</objectType>
    </variables>
    <variables>
        <name>PreInspection</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>WorkStep</objectType>
    </variables>
    <variables>
        <name>ServiceResourceRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceResource</objectType>
    </variables>
    <variables>
        <name>STRec</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceTerritory</objectType>
    </variables>
    <variables>
        <name>UserId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>WOLIRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>WorkOrderLineItem</objectType>
    </variables>
    <variables>
        <name>WorkOrderRec</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>WorkOrder</objectType>
    </variables>
</Flow>
